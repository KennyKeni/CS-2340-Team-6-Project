{% extends "base.html" %}
{% load static %}

{% block title %}Sign Up Â· DevJobs{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow">
      <div class="card-body p-4">
        <div class="text-center mb-4">
          <h2 class="fw-bold text-primary">Create Your Account</h2>
          <p class="text-muted">Join DevJobs and start your career journey</p>
        </div>

        <form method="post" id="signupForm">
          {% csrf_token %}
          
          <!-- User Type Selection -->
          <div class="mb-4">
            <label class="form-label fw-semibold">I am a:</label>
            <div class="row">
              <div class="col-6">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="user_type" id="applicant" value="applicant" checked>
                  <label class="form-check-label" for="applicant">
                    <strong>Job Seeker</strong><br>
                    <small class="text-muted">Looking for opportunities</small>
                  </label>
                </div>
              </div>
              <div class="col-6">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="user_type" id="recruiter" value="recruiter">
                  <label class="form-check-label" for="recruiter">
                    <strong>Recruiter</strong><br>
                    <small class="text-muted">Hiring talent</small>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Basic Information -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="id_first_name" class="form-label">First Name</label>
              <input type="text" class="form-control" id="id_first_name" name="first_name" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="id_last_name" class="form-label">Last Name</label>
              <input type="text" class="form-control" id="id_last_name" name="last_name" required>
            </div>
          </div>

          <div class="mb-3">
            <label for="id_username" class="form-label">Username</label>
            <input type="text" class="form-control" id="id_username" name="username" required>
          </div>

          <div class="mb-3">
            <label for="id_email" class="form-label">Email</label>
            <input type="email" class="form-control" id="id_email" name="email" required>
          </div>

          <div class="mb-3">
            <label for="id_phone_number" class="form-label">Phone Number (Optional)</label>
            <input type="tel" class="form-control" id="id_phone_number" name="phone_number" placeholder="(555) 123-4567">
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="id_password1" class="form-label">Password</label>
              <input type="password" class="form-control" id="id_password1" name="password1" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="id_password2" class="form-label">Confirm Password</label>
              <input type="password" class="form-control" id="id_password2" name="password2" required>
            </div>
          </div>

          <!-- Address Information -->
          <hr class="my-4">
          <h6 class="fw-semibold mb-3">Address Information</h6>
          
          <div class="mb-3">
            <label for="id_street_address" class="form-label">Street Address</label>
            <input type="text" class="form-control" id="id_street_address" name="street_address" required>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="id_city" class="form-label">City</label>
              <input type="text" class="form-control" id="id_city" name="city" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="id_state" class="form-label">State</label>
              <input type="text" class="form-control" id="id_state" name="state" required>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="id_country" class="form-label">Country</label>
              <input type="text" class="form-control" id="id_country" name="country" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="id_zip_code" class="form-label">ZIP Code</label>
              <input type="text" class="form-control" id="id_zip_code" name="zip_code" required>
            </div>
          </div>

          <div class="d-grid mb-3">
            <button type="submit" class="btn btn-primary btn-lg">Create Account</button>
          </div>
        </form>

        <div class="text-center">
          <p class="mb-0">Already have an account? 
            <a href="{% url 'account:login' %}" class="text-primary fw-semibold text-decoration-none">Sign in here</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.getElementById('signupForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const formData = new FormData(this);
  const data = Object.fromEntries(formData.entries());
  
  try {
    const response = await fetch('{% url "account:signup" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    
    if (result.success) {
      // Redirect to profile creation or home page
      if (data.user_type === 'applicant') {
        window.location.href = '{% url "applicant:create_profile" %}';
      } else {
        window.location.href = '{% url "home:index" %}';
      }
    } else {
      // Show error message
      const errorDiv = document.createElement('div');
      errorDiv.className = 'alert alert-danger mt-3';
      errorDiv.textContent = result.error || 'Signup failed. Please try again.';
      this.appendChild(errorDiv);
    }
  } catch (error) {
    console.error('Error:', error);
    const errorDiv = document.createElement('div');
    errorDiv.className = 'alert alert-danger mt-3';
    errorDiv.textContent = 'An error occurred. Please try again.';
    this.appendChild(errorDiv);
  }
});
</script>
{% endblock %}
