{% extends "base.html" %}

{% block title %}My Applications · DevJobs{% endblock %}

{% block extra_head %}
<style>
  /* Card */
  .application-card { border-radius: .75rem; }
  .job-meta { color: #6c757d; font-size: .9rem; }

  /* Progress bar + labels width (90% of previous) */
  .stepper,
  .step-labels {
    width: 90%;
    margin-inline: auto;
  }

  /* Stepper grid: [dot][line] x4 + [dot] */
  .stepper {
    display: grid;
    grid-template-columns: 18px 1fr 18px 1fr 18px 1fr 18px 1fr 18px;
    column-gap: .75rem;
    align-items: center;
  }
  .stepper .dot {
    width: 18px; height: 18px; border-radius: 50%;
    background: #dee2e6;
  }
  .stepper .dot.done { background: #198754; }
  .stepper .line {
    height: 4px; width: 100%;
    background: #dee2e6; border-radius: 2px;
  }
  .stepper .line.done { background: #198754; }

  /* Labels: place each label in the dot column (1,3,5,7,9),
     then center it EXACTLY under the dot using translateX(-50%). */
  .step-labels {
    display: grid;
    grid-template-columns: 18px 1fr 18px 1fr 18px 1fr 18px 1fr 18px;
    column-gap: .75rem;
    margin-top: .25rem;
  }
  .step-labels span {
    position: relative;
    left: 50%;
    transform: translateX(-50%);  /* center to the dot, not the cell */
    font-size: .8rem;
    color: #6c757d;
    white-space: nowrap;           /* keep on one line */
    overflow: visible;             /* allow text to extend */
    text-align: center;
  }
  .step-labels span:nth-child(1) { grid-column: 1; }
  .step-labels span:nth-child(2) { grid-column: 3; }
  .step-labels span:nth-child(3) { grid-column: 5; }
  .step-labels span:nth-child(4) { grid-column: 7; }
  .step-labels span:nth-child(5) { grid-column: 9; }

  @media (max-width: 420px) {
    .step-labels span { font-size: .75rem; }
  }
</style>
{% endblock %}


{% block content %}
<h1 class="h4 mb-4">My Applications</h1>

{% if applications %}
  <div class="vstack gap-3">
    {% for app in applications %}
      <div class="card application-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <div class="h5 mb-1">{{ app.job.title }}</div>
              <div class="job-meta">{{ app.job.summary|truncatechars:140 }}</div>
            </div>
            <div class="text-end text-muted small">
              Updated {{ app.updated_at|date:"M j, Y" }}
            </div>
          </div>

          <!-- Stepper -->
          <div class="stepper mb-2">
            {% for code, label in steps %}
              <span class="dot {% if forloop.counter <= app.step %}done{% endif %}"></span>
              {% if not forloop.last %}
                <span class="line {% if forloop.counter < app.step %}done{% endif %}"></span>
              {% endif %}
            {% endfor %}
          </div>
          <div class="step-labels">
            {% for code, label in steps %}
              <span>{{ label }}</span>
            {% endfor %}
          </div>

          <div class="mt-3 small text-muted">
            Current status: <strong>{{ app.get_status_display }}</strong>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center text-muted py-5">
    You haven’t applied to any jobs yet.
  </div>
{% endif %}
{% endblock %}
